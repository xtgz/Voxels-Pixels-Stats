var startButton,pageContentElement,authInterval,voxels_username,voxels_location="",finalFetchComplete=!1;window.contentScriptReady=!0;const apiURL="https://pixels-api.xyz/API/load_data.php";var nodeNames=[],premium=!1,loadTasksF=!1,currentActiveTab="timers";const version="43";function startLoad(){loadBasicOverlay(),initiate()}function checkForHUD(){let e=document.querySelector(nodeNames.hudTopLeft);e?authUser():setTimeout(checkForHUD,100)}function initiate(){function e(){try{chrome.storage.local.get(["userStatus","auth","premium"],function(e){if(chrome.runtime.lastError){displayInfo({title:"Update!",rows:[{text:"Voxels has received an updated. Please reload this page."}]});return}e.userStatus?(clearInterval(authInterval),getNodeNames(),e.auth?(loadTitleSection("timers"),loadTimers(1)):startAuthProcess()):displayInfo({title:"How to login:",rows:[{image:"login.png",text:"Click on the extension in the top right corner to sign in."}]})})}catch(e){extensionUpdated()}}authInterval=setInterval(e,1e3),e()}function extensionUpdated(){displayInfo({title:"Update!",rows:[{text:"Voxels has received an updated. Please reload this page."}]})}function startAuthProcess(){displayInfo({title:"Next step:",rows:[{image:"authenticate.png",text:"Click on your player button to link your profile."}]}),checkForHUD()}function getNodeNames(){chrome.storage.local.get("node_info",function(e){void 0!==e.node_info&&(nodeNames=chrome.runtime.lastError?["error"]:e.node_info)})}function displayInfo(e){reloadOverlay();let t=document.querySelector(".voxels-main");var a=document.createElement("div");a.classList.add("voxels-main-top-section"),t.appendChild(a);var i=document.createElement("a");i.classList.add("voxels-main-title"),i.href="https://voxels-extension.com",i.target="_blank",i.textContent="Voxels-Extension.com",a.appendChild(i);var n=document.createElement("div");if(n.classList.add("voxels-main-setup","pixel-border"),n.style.display="block",t.appendChild(n),e.rows[0].image){var s=document.createElement("img");s.src=chrome.runtime.getURL("images")+"/Setup/"+e.rows[0].image,s.classList.add("voxels-setup-image"),n.appendChild(s)}var o=document.createElement("p");o.textContent=e.rows[0].text,o.classList.add("voxels-setup-text"),n.appendChild(o)}function authUser(){chrome.storage.local.get(["user_info"],function(e){var t=e.user_info,a=document.querySelector('img[aria-label="Player"]'),i=a.closest("button");function n(){Array.from(document.body.getElementsByTagName("*")).some(function(e){return e.textContent.trim()===t})&&(chrome.storage.local.set({auth:!0}),reloadOverlay(),loadTitleSection("timers"),loadTimers(1),a.style.border="none",i.style.filter="",i.style.opacity="",i.removeEventListener("click",s))}function s(e){setTimeout(n,10)}a.style.border="2px solid red",a.style.borderRadius="15px",i.style.opacity=1,i.style.filter="brightness(150%)",i.addEventListener("click",s)})}function getUserData(){return new Promise((e,t)=>{chrome.storage.local.get(["user_info","user_acde"],function(a){let i=a.user_info,n=a.user_acde;i?(loadingScreen(1),(function e(t,a,i=3,n=5e3){return new Promise((e,s)=>{let o=()=>{fetch(t,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(a)}).then(e=>{if(200!==e.status)throw Error("fail");return e.json()}).then(t=>{let a=t.status;if("ok"===a){chrome.storage.local.set({timer_data:t.data.timer,storage_data:t.data.storage,task_data:t.data.tasks,node_info:t.data.nodeData,user_acde:t.data.acde}),getNodeNames(),loadTasksF=t.data.loadTasksF,finalFetchComplete=!0,loadingScreen(0),t.data.news&&quickMessage(t.data.news,"news");let i=t.data.premium.premium,n=t.data.iData;if(i){let o=t.data.premium.premium_end,l=Math.floor(Date.now()/1e3);o>l&&(o-l<172800&&showAlert("Your premium runs out within the next 2 days! Renew now!","info"),premium=i)}var r=document.createElement("div");r.setAttribute("id","voxels-main-nav"),document.body.appendChild(r);var d=document.createElement("div");d.setAttribute("id","voxels-main-nav-inner"),d.classList.add("clickable"),r.appendChild(d),document.getElementById("voxels-main-nav-inner").onclick=function(){document.body.classList.toggle("js-voxels-active")},r.appendChild(createSubNavButtons());let c=0;document.addEventListener("keydown",function(e){if(null!==document.querySelector(".voxels-popup-info"))return;let t=Date.now();if("v"===e.key||"V"===e.key)document.body.classList.toggle("js-voxels-main-modal-active");else if(e.key===nodeNames.presst||e.key===nodeNames.pressT){var a=t-c;a<2e4?quickMessage("Please wait "+Math.round((2e4-a)/1e3)+"s...","error"):(inventoryModeTotal=!inventoryModeTotal,loadInventoryPrices(),c=t)}else if("r"===e.key||"R"===e.key)displayInventoryPrice=!displayInventoryPrice,togglePrices();else if(e.shiftKey&&e.code.startsWith("Digit")){let i=e.code.replace("Digit","");switch(i){case"1":changeTab("timers");break;case"2":changeTab("storages");break;case"3":changeTab("tasks");break;case"4":changeTabWithLimit(changeTab,"stats",1e4);break;case"5":changeTabWithLimit(changeTab,"premium",1e4)}}}),mainInterval(i,n),e(t.data.timer)}else console.log("Error in fetching user data:",t.error),s(Error(t.error))}).catch(e=>{console.log(e),i>0?(console.log(`Retrying in ${n/1e3} seconds. Remaining retries: ${i}`),setTimeout(o,n)):s(Error("Failed to fetch user data after retries"))})};o()})})("https://pixels-api.xyz/API/load_data.php",{name:i,acde:n,operation:"requestWithPremium",version:"43"}).then(e).catch(t)):quickMessage("Please logout and login to Voxels.","error")})})}startLoad();const lastTabChangeTimes={};function changeTabWithLimit(e,t,a){let i=Date.now(),n=lastTabChangeTimes[t];n&&i-n<a?quickMessage("Please wait "+Math.round((a-(i-n))/1e3)+"s...","error"):(e(t),lastTabChangeTimes[t]=i)}function loadBasicOverlay(){document.body.classList.toggle("js-voxels-main-modal-active");var e=document.createElement("div");e.setAttribute("id","voxels-main-modal"),e.setAttribute("data-draggable","true"),e.classList.add("pixel-border"),document.body.appendChild(e),window.innerWidth>540&&chrome.storage.local.get("modalPosition",function(t){if(t.modalPosition){e.style.top=t.modalPosition.top,e.style.left=t.modalPosition.left;let a=e.getBoundingClientRect();(a.top+a.height>window.innerHeight||a.left+a.width>window.innerWidth)&&(e.style.top="70px",e.style.left="20px")}});var t=document.createElement("div");t.setAttribute("id","voxels-main-modal-header"),t.setAttribute("data-drag-handle","true"),e.appendChild(t);var a=document.createElement("div");a.classList.add("voxels-exit-icon","clickable"),a.textContent="X",e.appendChild(a),a.addEventListener("click",function(){document.body.classList.toggle("js-voxels-main-modal-active")});var i=document.createElement("div");i.classList.add("voxels-main"),e.appendChild(i)}function createSubNavButtons(){var e=document.createElement("div");e.id="voxels-sub-nav";var t=createSubNavButton("timers","images/icons/icon__timer.svg"),a=createSubNavButton("storages","images/icons/icon__storage.svg"),i=createSubNavButton("tasks","images/icons/icon__task.svg"),n=createSubNavButton("stats","images/icons/icon__stats.svg"),s=createSubNavButton("premium","images/icons/icon__premium.svg");return e.appendChild(t),e.appendChild(a),e.appendChild(i),e.appendChild(n),e.appendChild(s),e}function createSubNavButton(e,t){let a=document.createElement("div");a.classList.add("voxels-sub-nav-button");var i=document.createElement("div");i.classList.add("voxels-sub-nav-button-icon","clickable"),a.appendChild(i);var n=document.createElement("img");i.appendChild(n),n.src=chrome.runtime.getURL(t);let s=limiter(function(){changeTab(e)},2e3);return a.addEventListener("click",function(){s()}),a}function changeTab(e){reloadOverlay(),document.body.classList.contains("js-voxels-main-modal-active")||document.body.classList.add("js-voxels-main-modal-active");let t=document.querySelectorAll(".voxels-hover-box");t.forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)}),loadTitleSection(e),currentActiveTab=e,tabNumber=0,"timers"===e?loadTimers(0):"storages"===e?(tabNumber=1,loadStorages(0)):"tasks"===e?(tabNumber=2,loadTasks(0)):"stats"===e?(tabNumber=3,loadStats(0)):"premium"===e&&(tabNumber=4,loadPremium());let a=document.getElementsByClassName("voxels-sub-nav-button");for(var i=0;i<a.length;i++)tabNumber==i?a[i].classList.add("js-voxels-tab-active"):a[i].classList.remove("js-voxels-tab-active")}function reloadOverlay(){let e=document.querySelector(".voxels-main");e.innerHTML=""}function displayPremium(){let e=document.querySelector(".voxels-main");var t=document.createElement("div");t.classList.add("voxels-main-premium","pixel-border","voxels-premium-promo");var a=document.createElement("div");a.classList.add("voxels-premium-title"),a.innerText="VOXELS PREMIUM",t.appendChild(a);var i=document.createElement("div");i.classList.add("voxels-premium-content");var n=document.createElement("div");n.classList.add("voxels-premium-list");var s=["Stats and graphs","Leaderboard & Seasons","50 Plots","Auto-Detect collecting","40 Storages","Tasks overview","More coming soon!"],o=document.createElement("ul");for(let l=0;l<s.length;l++){var r=document.createElement("li"),d=document.createElement("img");d.src=chrome.runtime.getURL("images/Other/Premium_small.png"),r.appendChild(d),r.appendChild(document.createTextNode(s[l])),o.appendChild(r)}n.appendChild(o),i.appendChild(n);var c=document.createElement("div");c.classList.add("voxels-main-premium-button"),c.innerText="Get premium!",i.appendChild(c),t.appendChild(i),t.addEventListener("click",function(){changeTab("premium")}),e.appendChild(t)}function loadTitleSection(e){let t=document.querySelector(".voxels-main");var a=document.createElement("div");a.classList.add("voxels-main-top-section"),t.appendChild(a);var i=document.createElement("a");if(i.classList.add("voxels-main-title","voxels-main-url"),i.href="https://voxels-extension.com",i.target="_blank",i.textContent="Voxels-Extension.com",a.appendChild(i),"premium"!==e){var n=document.createElement("hr");a.appendChild(n);var s=e.charAt(0).toUpperCase()+e.slice(1),o=document.createElement("div");o.textContent=s,o.classList.add("voxels-main-title"),a.appendChild(o)}}
function loadStats(){premium?loadStatsSetup():displayPremium()}function loadStatsSetup(){let e=document.querySelector(".voxels-main");var t=document.createElement("div");t.classList.add("voxels-main-stats","pixel-border");var a=document.createElement("div");a.classList.add("voxels-stats-header");var s=document.createElement("div");s.classList.add("voxels-stats-navigator");var l=document.createElement("div");l.classList.add("voxels-stats-nav-item","clickable","voxels-stats-active"),l.textContent="Stats";var n=document.createElement("div");n.classList.add("voxels-stats-nav-item","clickable"),n.textContent="Leaderboard";var i=document.createElement("div");i.classList.add("voxels-nav-divider"),s.appendChild(l),s.appendChild(i),s.appendChild(n),a.appendChild(s);var o=document.createElement("img");o.classList.add("voxels-stats-update"),o.src=chrome.runtime.getURL("/images/icons/icon__refresh.svg");let r=limiter(refreshStats,1e4);o.addEventListener("click",function(){r()}),a.appendChild(o),t.appendChild(a);var d=document.createElement("div");d.classList.add("voxels-stats-page"),t.appendChild(d),e.appendChild(t),l.addEventListener("click",function(){loadStatsPage("stats"),l.classList.add("voxels-stats-active"),n.classList.remove("voxels-stats-active")}),n.addEventListener("click",function(){loadStatsPage("leaderboard"),l.classList.remove("voxels-stats-active"),n.classList.add("voxels-stats-active")}),refreshStats()}function refreshStats(){chrome.storage.local.get("user_info",async function(e){let t=e.user_info;loadingScreen(1);try{let a=await makeFetchRequest(apiURL,{name:t,operation:"getStats"});if(!handleErrors(a)){if("logout"==a)initiate();else{loadingScreen(0);let s=document.querySelector(".voxels-stats-nav-item.voxels-stats-active");chrome.storage.local.set({stats:a.data},function(){loadStatsPage(s.textContent.toLowerCase())})}}}catch(l){console.error(l)}})}function loadStatsPage(e){chrome.storage.local.get(["stats","user_info"],function(t){clearStatsPage();let a=document.querySelector(".voxels-stats-page"),s=t.user_info;var l=new Date,n=l.getUTCDate()+"/"+(l.getUTCMonth()+1)+"/"+l.getUTCFullYear();if("stats"===e){userStats=t.stats.stats;let i=userStats.per_day,o=userStats.extra,r=document.createElement("div");r.classList.add("voxels-stats-basics");let d=document.createElement("div");if(d.classList.add("voxels-stats-name"),"world"in o?d.innerHTML=`${o.username} <span>- World</span> ${o.world}`:d.innerHTML=`${o.username} <span>- Offline</span>`,r.appendChild(d),"vip"in o){let c=document.createElement("div");c.classList.add("voxels-stats-field");let p=new Date(o.vip),v=p.toLocaleString();c.innerHTML=`<span>VIP: expires</span> ${v}`,r.appendChild(c)}let x=document.createElement("div");x.classList.add("voxels-stats-field");let m=o.pixels,u=o.total_value_usd.toFixed(2),g=(u/m).toFixed(2);x.innerHTML="<span>Pixels: </span>"+m+" <img src='"+chrome.runtime.getURL("images/Other/Pixel.png")+"'><span> = "+u+"$</span> (1 <img src='"+chrome.runtime.getURL("images/Other/Pixel.png")+"'> = ~"+g+"$)",r.appendChild(x);let h=document.createElement("div");h.classList.add("voxels-stats-field");let f=o.level;h.innerHTML="<span>Overall level: </span>"+f,r.appendChild(h),data=statsCalculations(i);let C=document.createElement("div");C.classList.add("voxels-stats-earnings");let L=new Date,$=L.toISOString().split("T")[0],b=L.getUTCDate(),k=L.getUTCMonth()+1,E,S,y,T,w=0;for(var P=0;P<i.length;P++)i[P].date===$&&(E=data[P].pixels_made,S=data[P].coins_total,y=data[P].c_p_ratio.toFixed(2),T=data[P].tasks_done,w=data[P].pixel_tasks);C.innerHTML="Earnings <span>("+b+"/"+k+")</span>";let _=["Pixels made","Coins spent","Coins spent per pixel","Tasks done","Pixel tasks"],I=[E,S,y,T,w],M=[`<img src="${chrome.runtime.getURL("images/Other/Pixel.png")}">`,`<img src="${chrome.runtime.getURL("images/Prices/coin.png")}">`,`<img src="${chrome.runtime.getURL("images/Prices/coin.png")}">`,"",""];for(let U=0;U<_.length;U++){let O=document.createElement("div");O.classList.add("voxels-stats-field");let H="Pixels made"===_[U]||"Coins spent"===_[U]||"Coins spent per pixel"===_[U]?M[U]+" ":"";O.innerHTML=`<span>${_[U]}:</span> ${H}${I[U]}`,C.appendChild(O)}r.appendChild(C);let D=document.createElement("div");function R(e,t,s){var l,n,i,o=document.createElement("div");o.classList.add("voxels-main-info"),a.appendChild(o);var r=(l=e,n=o,(i=document.createElement("canvas")).id=l,i.style.width="100%",i.style.maxWidth="600px",n.appendChild(i),i.getContext("2d"));new Chart(r,{type:"line",data:t,options:s})}D.classList.add("voxels-stats-earnings"),D.innerHTML="Graphs",r.appendChild(D),a.appendChild(r);var F={responsive:!0,interaction:{mode:"index",intersect:!1},stacked:!1,plugins:{title:{display:!1,text:"Earnings Chart",color:"white"},legend:{labels:{color:"white"}},tooltip:{titleColor:"white",bodyColor:"white",backgroundColor:"black"}},scales:{x:{grid:{color:e=>0===e.tick.value?"white":"transparent"},ticks:{color:"white"}},y:{beginAtZero:!0,grid:{color:e=>0===e.tick.value?"white":"rgba(255, 255, 255, 0.2)"},border:{dash:e=>0===e.tick.value?[]:[2,4]},ticks:{color:"white"}}}};function V(e,t){var a=[],s=t.map(t=>(function e(t,a,s,l,n,i){for(var o={data:[],label:l,borderColor:n,backgroundColor:n,fill:!1,tension:.4},r=s;r>=0;r--){var d=new Date;d.setUTCDate(d.getUTCDate()-r);var c,p=d.toISOString().split("T")[0],v=d.getUTCDate()+"/"+(d.getUTCMonth()+1);i.includes(v)||i.push(v);for(var x=!1,m=0;m<t.length;m++)if(t[m].date===p){x=!0,o.data.push(t[m][a]);break}x||o.data.push(0)}return o})(e,t.key,t.maxItems,t.label,t.color,a));return{labels:a,datasets:s}}R("chartCanvas1",V(data,[{key:"pixels_made",maxItems:6,label:"Pixels made",color:"#5ff600"}]),F),R("chartCanvas2",V(data,[{key:"coins_made",maxItems:6,label:"Coins made",color:"#e3ff36"},{key:"coins_spent",maxItems:6,label:"Coins spent",color:"#f75543"},{key:"coins_total",maxItems:6,label:"Coins total",color:"#f7af43"},{key:"c_p_ratio",maxItems:6,label:"Coins spent/Pixel",color:"#c2fa0a"}]),F),R("chartCanvas3",V(data,[{key:"tasks_done",maxItems:6,label:"Tasks",color:"#0a0efa"},{key:"pixel_tasks",maxItems:6,label:"Pixel tasks",color:"#0afada"},{key:"t_p_ratio",maxItems:6,label:"Tasks/Pixel",color:"#0afa7a"},{key:"pixel_percentage",maxItems:6,label:"% Pixel tasks",color:"#7e0afa"},{key:"pixel_per_pixel_task",maxItems:6,label:"Pixel per Pixel task",color:"#198a2f"}]),F)}else if("leaderboard"===e){let Y=t.stats.leaderboard,q=Y.season_active;if(q){let W=Y.season,z=Y.season_info,A=Y.season_prize;var B=document.createElement("div");B.classList.add("voxels-season");var G=document.createElement("div");G.classList.add("voxels-season-title");let Z=new Date(z.season_start),j=new Date(z.season_end),J=Z.getDate()+"/"+(Z.getMonth()+1)+"/"+Z.getFullYear(),K=j.getDate()+"/"+(j.getMonth()+1)+"/"+Z.getFullYear();G.innerHTML="<p class='voxels-text-color-main'>Voxels Season "+z.season_number+"</p> ("+J+" - "+K+")",B.appendChild(G);var N=document.createElement("div");N.classList.add("voxels-season-table"),B.appendChild(N);for(var Q=0;Q<W.length;Q++){var X=document.createElement("div");X.classList.add("voxels-leaderboard-row");var ee=document.createElement("div");ee.classList.add("voxels-leaderboard-column","voxels-text-color-main"),10==Q?ee.textContent="You":ee.innerHTML=Q+1+" <span>"+A[Q]+"<br><img class='voxels-leaderboard-pixels-icon' src='"+chrome.runtime.getURL("images/Other/Pixel.png")+"'></span>",X.appendChild(ee);var et=document.createElement("div");et.classList.add("voxels-leaderboard-column"),et.textContent=W[Q].username,W[Q].username===s&&et.classList.add("voxels-text-color-main"),X.appendChild(et);var ea=document.createElement("div");ea.classList.add("voxels-leaderboard-column","voxels-text-color-main"),ea.textContent=W[Q].pixels_made,X.appendChild(ea),N.appendChild(X)}a.appendChild(B)}let es=Y.day;var el=document.createElement("div");el.classList.add("voxels-leaderboard");var G=document.createElement("div");G.classList.add("voxels-leaderboard-title"),G.innerHTML="<span class='voxels-text-color-main'>Leaderboard</span> ("+n+") <img class='voxels-leaderboard-pixels-icon' src='"+chrome.runtime.getURL("images/Other/Pixel.png")+"'>",el.appendChild(G);var en=document.createElement("div");en.classList.add("voxels-leaderboard-table"),el.appendChild(en);for(var Q=0;Q<es.length;Q++){var X=document.createElement("div");X.classList.add("voxels-leaderboard-row");var ee=document.createElement("div");ee.classList.add("voxels-leaderboard-column","voxels-text-color-main"),ee.textContent=Q+1,X.appendChild(ee);var et=document.createElement("div");et.classList.add("voxels-leaderboard-column"),et.textContent=es[Q].username,es[Q].username===s&&et.classList.add("voxels-text-color-main"),X.appendChild(et);var ea=document.createElement("div");ea.classList.add("voxels-leaderboard-column","voxels-text-color-main"),ea.textContent=es[Q].pixels_made,X.appendChild(ea),en.appendChild(X)}a.appendChild(el);var ei=document.createElement("div");if(ei.classList.add("voxels-stats-info"),ei.textContent="Stats get updated every 60 min.",a.appendChild(ei),!t.stats.stats.extra.optout){var eo=document.createElement("div");eo.classList.add("voxels-stats-info"),eo.innerHTML='To opt out of the leaderboard and Voxels Seasons you can click <a href="#" id="optOutLink">here</a>.',a.appendChild(eo),document.getElementById("optOutLink").addEventListener("click",function(e){e.preventDefault(),userOptout(t.stats.stats.extra.PID)})}}})}function userOptout(e){voxelsConfirm("If you continue you won't be able to participate in this Voxels Season or the Leaderboard. Opt out?",function(t){t&&chrome.storage.local.get("user_info",async function(t){let a=t.user_info;loadingScreen(1);try{let s=await makeFetchRequest(apiURL,{name:a,operation:"leaderboardOptout",extra:e});handleErrors(s)||("logout"==s?initiate():(loadingScreen(0),refreshStats(),quickMessage("You have opted out of Voxels Seasons & the leaderboard.","news")))}catch(l){console.error(l)}})})}function statsCalculations(e){let t=new Date().toISOString().slice(0,10),a=e.some(e=>e.date===t);return a||e.push({date:t,pixels_made:0,coins_made:0,coins_spent:0,tasks_done:0,pixel_tasks:0,coins_total:0,c_p_ratio:0,t_p_ratio:0,pixel_percentage:0,normal_tasks:0}),e.forEach(e=>{let t=e.pixels_made,a=e.coins_made,s=e.coins_spent,l=e.tasks_done,n=e.pixel_tasks,i=s-a;e.coins_spent*=-1,e.coins_total=-1*i,e.c_p_ratio=t>0?i/t:0,e.t_p_ratio=t>0?l/t:0,e.pixel_percentage=l>0?n/l*100:0,e.pixel_per_pixel_task=t>0?t/n:0,e.normal_tasks=l-n}),e}function clearStatsPage(){document.querySelector(".voxels-stats-page").innerHTML=""}